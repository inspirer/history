      ---=== Squirrel for USR Sportser 33.6(56K) Voice modems ===---
                    Copyright (c)2000 Eugeniy Gryaznov
                           Version 1.16/release

     Эта  программа  служит  для  определения  того,  звонят голосом или
  модемом.  Работает  на  USR  Sportser 33.6(56K) Voice модемах, а также
  скорее   всего   будет   работать  и  на  других  войсовых  модемах. В
  использовании  очень  проста, всего лишь надо записать в мэйлер, чтобы
  она  запускалась  при входящем звонке, и при обнаружении определенного
  флага мэйлер отвечал на звонок.

     Для t-mail-а:

   ----- DOS ------
       "Process_Flag ata.sq KeyMacro <Alt-A>"
       "Extern RING | <drive>:\<path>\squirrel.exe mailer"
   ----- Win ------
       "Process_Flag ata.sq KeyMacro <Alt-A>"
       "Extern RING | !start /w <drive>:\<path>\squirrel.pif"

         В .pif файле должно быть:
            Cmd line:     <drive>:\<path>\squirrel.exe mailer
            Working:      <drive>:\<path>
            Batch file:
            Shortcut key: None
            Run:          Normal Window
            √ Close on exit
   ----------------

     Если обнаружен голосовой вызов, она посылает в трубку сигнал вызова
  АТС  и пищит на спикере столько раз, сколько указано в конфигурации, и
  если никто не подошел выполняет функции автоответчика.

  -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --

   С автором можно связаться:
   
       Fido:  2:5030/611.23 or 2:5030/566.8
       Mail:  enlin@i.am

   Новые версии:
   
       Inet:  http://enlin.chat.ru/

  -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
                                vi - модемы

     Если  у  вас  в  модеме  нет  гнезда  для  наушников и микрофона, и
   поддерживается  только  урезанный  voice-овый  формат - vi, то работа
   АОН-а,  определения  голос/модем  и  сохранение  в WAV-файлы может не
   работать. Если оно так, то добавьте в .ctl-ник одну строку : "use_gsm
   0" и запишите файл (squirrel.exe rec test.gsm). После этого пошлите
   первые 2Kb этого файла мне.

  -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
                          Требования к системе.

     Нужен  голосовой модем. Фоссил не нужен, но может присутствовать. Я
  не несу ответственности за ваше hardware/software.

  -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
                                   Фича

     Если  у  вас  в  тмыле  запускается  внешний  процесс,  в это время
  раздается  звонок  и  тмыл  пишет RING1 дожидается X звонков, а дальше
  начинает  отвечать  обычно,  то  надо  запускать внешний процесс с "+"
  например "+c:\fido\sds\sdf.exe".

  -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
                           Формат ".gsm" (Звук)

     Это  GSM,  без символов начала/конца фрейма. Совместим с VOICEMAN и
  др.  В  .ctl-нике  можно GSM поменять на ADPCM. Существует возможность
  сохранять  звук  в  WAV-ах  (PCM,8/16-bit,8kHz),  для  этого поставьте
  "use_gsm=1" и "wave_output=1".
     Прослушивать  сообщения  на автоответчике можно например следующими
  досовскими коммандами:

    WAV >> for %%1 in (*.wav) do start /w %%1
    GSM >> for %%1 in (*.gsm) do squirrel.exe play %%1

  Записывать сообщения для автоответчика можно с помощью программы:
    "Voice Management Utility for USR Voice Modems, Version 1.0 Alpha"
  или конвертить из .WAV (8KHz,mono) с помощью
    "GSM <-> WAV Converter, Version 1.00 Alpha"
  (программы от Vasily Mishenin-а)

  -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
                                   АОН

     Пока АОН не является стабильным, он не расчитан на АТС-ки у которых
  кривые  времена  и  возможно  частоты,  это  сейчас находится в стадии
  доработки.  АОН  работает,  только  если установлен формат framed GSM.
  Принцип действия АОН-а:

     1. Запрос номера.
     500hz  в  течении одной десятой секунды в линию (длительность может
  варьироваться от 0.08 до 0.2 сек)

     2. Небольшая задержка
     регулируется <AON_delay_after> (чем меньше тем лучше, у меня 0)

     3. Ответ АТС
     С  помощью  шести базовых частот (F0=700, F1=900, F2=1100, F3=1300,
  F4=1500,  F5=1700)  кодируется пятнадцать цифер, т.е. цифра есть сумма
  двух частот:

    1 - F0F1    6 - F2F3    11 - F0F5
    2 - F0F2    7 - F0F4    12 - F1F5
    3 - F1F2    8 - F1F4    13 - F2F5
    4 - F0F3    9 - F2F4    14 - F3F5
    5 - F1F3    0 - F3F4    15 - F4F5

     Из  них  1-0  это  цифры  номера, остальные - служебные. Одна цифра
  передается в течении 0.04 сек, в течении двух фреймов

  Кодировка Номера:
    Пусть есть телефон: >123-4500<
    Сначала расставим повторы: >1,2,3,4,5,0,14<
    Перевернем: >14,0,5,4,3,2,1<
  АТС передает:
    <категория>,<кодированный_номер>,13,<категория>,<кодированный_номер>,13
  Например:
    1, 14, 0, 5, 4, 3, 2, 1, 13, ...

     Для  настройки  аона  установите  <aon_debug=1>.  После определения
  номера, в лог будет записываться вся отладочная информация для каждого
  кадра  (0.02сек). Наберите некоторую статистику. Отладочная информация
  выдается в следующем формате:


  <№частоты1> <№частоты2> : <цифра>,  <вероятность> : <0> <1> <2> <3> <4> <5>

  <0> - <5> : уровень сигнала на частоте 700,900,1100,1300,1500,1700 соотв
  <вероятн> : чем больше, тем вероятней что это правильная цифра
  <цифра>   : цифра, кодируемая <№част1/2>. если 14, то это повторение
              предыдущей цифры в номере.
  <№част1>  : порядковый номер частоты, на которой сигнал максимален
  <№част2>  : порядковый номер частоты, на которой сигнал на втором месте


  Характерные значения (у меня):

  1: Нет сигнала (тихо в линии)
     1 2 : 3 , 197 : 16 208 52 10 37 0

  2: АОН передает "четверку"
     3 0 : 4 , 152517566 : 73124650 133965 220690 80681225 834545 99109

     По минимальной встречающейся <вероятности>, при которой есть сигнал
  (для вашей линии), выставляем AON_signal. Я его примерно определил как
  2*10^6.  если  <вероятность> меньше чем <AON_signal>, то будем считать
  что цифра не определилась.

     Если  времена  на АТС-ке не сбиты, то один из двух соседних фреймов
  по  0.02  сек.  будет  полностью попадать в то время, когда передается
  цифра. Какой из них попал на цифру определяется по <вероятности>

     В  идеале,  для номера >1234500< в логе вы должны увидеть строки, в
  которых цифры будут в след. порядке:

   1, 1, 14, 14, 0, 0, 5, 5, 4, 4, 3, 3, 2, 2, 1, 1, 13, 13,

     Для  того,  чтобы  узнать  почему  не определился номер, достаточно
  посмотреть  в  лог на отладочную информацию. Если во время определения
  не  пришел  сигнал,  то все <вероятности> будут очень маленькими. Если
  пришла  только часть сигнала, то это тоже можно увидеть, т.к. он будет
  в самом начале, и будет занимать явно меньше ~20 строк.

  -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
                                Параметры

 Use <squirrel.exe> <action> [<action param>] [switches]

  action:   PLAY,REC,MAILER,MAIN
      PLAY f.gsm     Проиграть файл. Для этого надо воткнуть в модем
                     наушники, или можно запустив с ключом /L проиграть
                     в линию.
      REC f.gsm      Записать файл. Записывается с микрофона, воткнутого
                     в модем, если запускать с ключом /L, будет записываться
                     с линии.
      MAILER         Запускает стандартную схему определения голос/модем,
                     и в зависимости от этого, выполняет разные действия
      MAIN           Использование как простого автоответчика.
      CONV f.gsm     Конвертирует заданный GSM в WAV используя ключ /B можно
                     задать формат 8/16 бит. Имя выходного файла будет f.wav

  switches: [/L] [/D] [/P]    подробнее см. <.ctl>
      /L             Использовать в качестве записыв/проигр устроиства
                     телефонную линию
      /D             показывать отладочную информацию (что посылается в модем,
                     и что из него приходит)
      /P             Ключ совместимости с фоссилом
      /B             Переключает формат .WAV : 8 или 16bit


  -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
                       Выбор другого формата звука

     Если  вы  используете  Squirrel  только  как автоответчик, и хотите
  попробовать   другие   форматы,   поддерживаемые   модемом.   Добавьте
  нижеследующие строчки в конец squirrel.ctl.

  !!! Но при этом не будет работать АОН, и нельзя будет запускать его
  !!! в режиме мэйлера

  -- -- -- -- [ cut ] -- -- -- --

; Формат звука (GSM, ADPCM, IMA ADPCM)
;
; !!!  Эту секцию нужно трогать, в том случае если Squirrel работает только
; !!! в режиме мастера, и не использует АОН. Если используется АОН, распозна-
; !!! вание голос/модем, сохранение сообщений в WAV-файлах, то изменение этих
; !!! параметров нарушит работу всего.

; use_gsm         1
;
;  Если здесь поставлена единица, то используется формат GSM с фреймами,
; т.е в сохраняемый файл не записываются заголовки фреймов, а между фреймами
; делаются небольшие задержки.
;   GSM:   1 (или 0 если модем поддерживает GSM без фреймов)
;   ADPCM: 0

;
;  Если вы хотите использовать другой формат звука, то измените строки:
;
;   play_st    AT#VSM=129,8000#VTX     ; или 130 для IMA ADPCM
;   rec_st     AT#VSM=129,8000#VRX     ; или 130 для IMA ADPCM
;   use_gsm    0

  -- -- -- -- [ cut ] -- -- -- --
